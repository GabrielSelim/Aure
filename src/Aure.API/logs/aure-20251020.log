2025-10-20 11:04:30.961 -04:00 [INF] Starting Aure API application
2025-10-20 11:04:31.066 -04:00 [INF] User profile is available. Using 'C:\Users\gabriel\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-10-20 11:04:31.281 -04:00 [INF] Now listening on: http://localhost:5203
2025-10-20 11:04:31.286 -04:00 [INF] Application started. Press Ctrl+C to shut down.
2025-10-20 11:04:31.289 -04:00 [INF] Hosting environment: Development
2025-10-20 11:04:31.292 -04:00 [INF] Content root path: c:\Users\gabriel\source\repos\GabrielSelim\Aure\src\Aure.API
2025-10-20 11:04:38.452 -04:00 [INF] Application is shutting down...
2025-10-20 11:04:52.723 -04:00 [INF] Starting Aure API application
2025-10-20 11:04:52.875 -04:00 [INF] User profile is available. Using 'C:\Users\gabriel\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-10-20 11:04:52.965 -04:00 [INF] Now listening on: http://localhost:5203
2025-10-20 11:04:52.968 -04:00 [INF] Application started. Press Ctrl+C to shut down.
2025-10-20 11:04:52.970 -04:00 [INF] Hosting environment: Development
2025-10-20 11:04:52.971 -04:00 [INF] Content root path: c:\Users\gabriel\source\repos\GabrielSelim\Aure\src\Aure.API
2025-10-20 11:05:03.205 -04:00 [INF] Request starting HTTP/1.1 GET http://localhost:5203/ - null null
2025-10-20 11:05:03.322 -04:00 [INF] Request finished HTTP/1.1 GET http://localhost:5203/ - 301 0 null 121.3866ms
2025-10-20 11:05:03.337 -04:00 [INF] Request starting HTTP/1.1 GET http://localhost:5203/index.html - null null
2025-10-20 11:05:03.441 -04:00 [INF] Request finished HTTP/1.1 GET http://localhost:5203/index.html - 200 null text/html;charset=utf-8 103.9801ms
2025-10-20 11:05:03.622 -04:00 [INF] Request starting HTTP/1.1 GET http://localhost:5203/swagger-ui-standalone-preset.js - null null
2025-10-20 11:05:03.622 -04:00 [INF] Request starting HTTP/1.1 GET http://localhost:5203/swagger-ui-bundle.js - null null
2025-10-20 11:05:03.625 -04:00 [INF] Request starting HTTP/1.1 GET http://localhost:5203/swagger-ui.css - null null
2025-10-20 11:05:03.676 -04:00 [INF] Sending file. Request path: '/swagger-ui-standalone-preset.js'. Physical path: 'N/A'
2025-10-20 11:05:03.683 -04:00 [INF] Request finished HTTP/1.1 GET http://localhost:5203/swagger-ui-standalone-preset.js - 200 230280 text/javascript 60.6437ms
2025-10-20 11:05:03.713 -04:00 [INF] Sending file. Request path: '/swagger-ui.css'. Physical path: 'N/A'
2025-10-20 11:05:03.777 -04:00 [INF] Request finished HTTP/1.1 GET http://localhost:5203/swagger-ui.css - 200 152034 text/css 151.6456ms
2025-10-20 11:05:03.855 -04:00 [INF] Sending file. Request path: '/swagger-ui-bundle.js'. Physical path: 'N/A'
2025-10-20 11:05:03.877 -04:00 [INF] Request finished HTTP/1.1 GET http://localhost:5203/swagger-ui-bundle.js - 200 1456926 text/javascript 254.7015ms
2025-10-20 11:05:04.214 -04:00 [INF] Request starting HTTP/1.1 GET http://localhost:5203/swagger/v1/swagger.json - null null
2025-10-20 11:05:04.264 -04:00 [INF] Request starting HTTP/1.1 GET http://localhost:5203/favicon-32x32.png - null null
2025-10-20 11:05:04.297 -04:00 [INF] Sending file. Request path: '/favicon-32x32.png'. Physical path: 'N/A'
2025-10-20 11:05:04.319 -04:00 [INF] Request finished HTTP/1.1 GET http://localhost:5203/favicon-32x32.png - 200 628 image/png 54.9837ms
2025-10-20 11:05:04.556 -04:00 [INF] Request finished HTTP/1.1 GET http://localhost:5203/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 342.1262ms
2025-10-20 11:08:04.711 -04:00 [INF] Request starting HTTP/1.1 GET http://localhost:5203/api/Auth/perfil - null null
2025-10-20 11:08:04.762 -04:00 [WRN] Failed to determine the https port for redirect.
2025-10-20 11:08:04.910 -04:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-10-20 11:08:04.914 -04:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-10-20 11:08:04.919 -04:00 [INF] HTTP GET /api/Auth/perfil responded 401 in 166.8941 ms
2025-10-20 11:08:04.923 -04:00 [INF] Request finished HTTP/1.1 GET http://localhost:5203/api/Auth/perfil - 401 0 null 216.1745ms
2025-10-20 11:08:16.802 -04:00 [INF] Request starting HTTP/1.1 GET http://localhost:5203/api/Audit/logs - null null
2025-10-20 11:08:16.820 -04:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
RolesAuthorizationRequirement:User.IsInRole must be true for one of the following roles: (Admin)
2025-10-20 11:08:16.822 -04:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-10-20 11:08:16.826 -04:00 [INF] HTTP GET /api/Audit/logs responded 401 in 16.3438 ms
2025-10-20 11:08:16.828 -04:00 [INF] Request finished HTTP/1.1 GET http://localhost:5203/api/Audit/logs - 401 0 null 26.043ms
2025-10-20 11:08:21.931 -04:00 [INF] Request starting HTTP/1.1 GET http://localhost:5203/api/Audit/kyc - null null
2025-10-20 11:08:21.947 -04:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
RolesAuthorizationRequirement:User.IsInRole must be true for one of the following roles: (Admin|Company)
2025-10-20 11:08:21.950 -04:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-10-20 11:08:21.954 -04:00 [INF] HTTP GET /api/Audit/kyc responded 401 in 11.2953 ms
2025-10-20 11:08:21.959 -04:00 [INF] Request finished HTTP/1.1 GET http://localhost:5203/api/Audit/kyc - 401 0 null 27.3466ms
2025-10-20 11:13:07.792 -04:00 [INF] Request starting HTTP/1.1 POST http://localhost:5203/api/Registration/aceitar-convite/1 - application/json 26
2025-10-20 11:13:07.817 -04:00 [INF] CORS policy execution successful.
2025-10-20 11:13:07.846 -04:00 [INF] Executing endpoint 'Aure.API.Controllers.RegistrationController.AceitarConvite (Aure.API)'
2025-10-20 11:13:07.990 -04:00 [INF] Route matched with {action = "AceitarConvite", controller = "Registration"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] AceitarConvite(System.String, Aure.Application.DTOs.User.AcceptInviteRequest) on controller Aure.API.Controllers.RegistrationController (Aure.API).
2025-10-20 11:13:09.772 -04:00 [WRN] Entity 'User' has a global query filter defined and is the required end of a relationship with the entity 'AuditLog'. This may lead to unexpected results when the required entity is filtered out. Either configure the navigation as optional, or define matching query filters for both entities in the navigation. See https://go.microsoft.com/fwlink/?linkid=2131316 for more information.
2025-10-20 11:13:09.775 -04:00 [WRN] Entity 'Company' has a global query filter defined and is the required end of a relationship with the entity 'CompanyRelationship'. This may lead to unexpected results when the required entity is filtered out. Either configure the navigation as optional, or define matching query filters for both entities in the navigation. See https://go.microsoft.com/fwlink/?linkid=2131316 for more information.
2025-10-20 11:13:09.777 -04:00 [WRN] Entity 'Contract' has a global query filter defined and is the required end of a relationship with the entity 'Invoice'. This may lead to unexpected results when the required entity is filtered out. Either configure the navigation as optional, or define matching query filters for both entities in the navigation. See https://go.microsoft.com/fwlink/?linkid=2131316 for more information.
2025-10-20 11:13:09.785 -04:00 [WRN] Entity 'Company' has a global query filter defined and is the required end of a relationship with the entity 'KycRecord'. This may lead to unexpected results when the required entity is filtered out. Either configure the navigation as optional, or define matching query filters for both entities in the navigation. See https://go.microsoft.com/fwlink/?linkid=2131316 for more information.
2025-10-20 11:13:09.787 -04:00 [WRN] Entity 'Contract' has a global query filter defined and is the required end of a relationship with the entity 'LedgerEntry'. This may lead to unexpected results when the required entity is filtered out. Either configure the navigation as optional, or define matching query filters for both entities in the navigation. See https://go.microsoft.com/fwlink/?linkid=2131316 for more information.
2025-10-20 11:13:09.788 -04:00 [WRN] Entity 'User' has a global query filter defined and is the required end of a relationship with the entity 'Session'. This may lead to unexpected results when the required entity is filtered out. Either configure the navigation as optional, or define matching query filters for both entities in the navigation. See https://go.microsoft.com/fwlink/?linkid=2131316 for more information.
2025-10-20 11:13:09.789 -04:00 [WRN] Entity 'Payment' has a global query filter defined and is the required end of a relationship with the entity 'SplitExecution'. This may lead to unexpected results when the required entity is filtered out. Either configure the navigation as optional, or define matching query filters for both entities in the navigation. See https://go.microsoft.com/fwlink/?linkid=2131316 for more information.
2025-10-20 11:13:09.791 -04:00 [WRN] Entity 'Contract' has a global query filter defined and is the required end of a relationship with the entity 'SplitRule'. This may lead to unexpected results when the required entity is filtered out. Either configure the navigation as optional, or define matching query filters for both entities in the navigation. See https://go.microsoft.com/fwlink/?linkid=2131316 for more information.
2025-10-20 11:13:09.792 -04:00 [WRN] Entity 'Contract' has a global query filter defined and is the required end of a relationship with the entity 'TokenizedAsset'. This may lead to unexpected results when the required entity is filtered out. Either configure the navigation as optional, or define matching query filters for both entities in the navigation. See https://go.microsoft.com/fwlink/?linkid=2131316 for more information.
2025-10-20 11:13:14.957 -04:00 [ERR] An error occurred using the connection to database 'aure_db' on server 'tcp://localhost:5432'.
2025-10-20 11:13:14.999 -04:00 [INF] A transient exception occurred during execution. The operation will be retried after 0ms.
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): Nenhuma conexão pôde ser feita porque a máquina de destino as recusou ativamente.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.PoolingDataSource.OpenNewConnector(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.PoolingDataSource.<Get>g__RentAsync|33_0(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): Nenhuma conexão pôde ser feita porque a máquina de destino as recusou ativamente.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.PoolingDataSource.OpenNewConnector(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.PoolingDataSource.<Get>g__RentAsync|33_0(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
2025-10-20 11:13:19.102 -04:00 [ERR] An error occurred using the connection to database 'aure_db' on server 'tcp://localhost:5432'.
2025-10-20 11:13:19.108 -04:00 [INF] A transient exception occurred during execution. The operation will be retried after 1026ms.
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): Nenhuma conexão pôde ser feita porque a máquina de destino as recusou ativamente.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.PoolingDataSource.OpenNewConnector(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.PoolingDataSource.<Get>g__RentAsync|33_0(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): Nenhuma conexão pôde ser feita porque a máquina de destino as recusou ativamente.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.PoolingDataSource.OpenNewConnector(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.PoolingDataSource.<Get>g__RentAsync|33_0(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
2025-10-20 11:13:24.255 -04:00 [ERR] An error occurred using the connection to database 'aure_db' on server 'tcp://localhost:5432'.
2025-10-20 11:13:24.260 -04:00 [INF] A transient exception occurred during execution. The operation will be retried after 3034ms.
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): Nenhuma conexão pôde ser feita porque a máquina de destino as recusou ativamente.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.PoolingDataSource.OpenNewConnector(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.PoolingDataSource.<Get>g__RentAsync|33_0(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): Nenhuma conexão pôde ser feita porque a máquina de destino as recusou ativamente.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.PoolingDataSource.OpenNewConnector(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.PoolingDataSource.<Get>g__RentAsync|33_0(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
2025-10-20 11:13:31.426 -04:00 [ERR] An error occurred using the connection to database 'aure_db' on server 'tcp://localhost:5432'.
2025-10-20 11:13:31.437 -04:00 [ERR] An exception occurred while iterating over the results of a query for context type 'Aure.Infrastructure.Data.AureDbContext'.
Microsoft.EntityFrameworkCore.Storage.RetryLimitExceededException: The maximum number of retries (3) was exceeded while executing database operations with 'NpgsqlRetryingExecutionStrategy'. See the inner exception for the most recent failure.
 ---> Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): Nenhuma conexão pôde ser feita porque a máquina de destino as recusou ativamente.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.PoolingDataSource.OpenNewConnector(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.PoolingDataSource.<Get>g__RentAsync|33_0(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
Microsoft.EntityFrameworkCore.Storage.RetryLimitExceededException: The maximum number of retries (3) was exceeded while executing database operations with 'NpgsqlRetryingExecutionStrategy'. See the inner exception for the most recent failure.
 ---> Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): Nenhuma conexão pôde ser feita porque a máquina de destino as recusou ativamente.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.PoolingDataSource.OpenNewConnector(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.PoolingDataSource.<Get>g__RentAsync|33_0(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
2025-10-20 11:13:31.468 -04:00 [INF] Executed action Aure.API.Controllers.RegistrationController.AceitarConvite (Aure.API) in 23470.9485ms
2025-10-20 11:13:31.475 -04:00 [INF] Executed endpoint 'Aure.API.Controllers.RegistrationController.AceitarConvite (Aure.API)'
2025-10-20 11:13:31.481 -04:00 [ERR] HTTP POST /api/Registration/aceitar-convite/1 responded 500 in 23675.2758 ms
Microsoft.EntityFrameworkCore.Storage.RetryLimitExceededException: The maximum number of retries (3) was exceeded while executing database operations with 'NpgsqlRetryingExecutionStrategy'. See the inner exception for the most recent failure.
 ---> Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): Nenhuma conexão pôde ser feita porque a máquina de destino as recusou ativamente.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.PoolingDataSource.OpenNewConnector(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.PoolingDataSource.<Get>g__RentAsync|33_0(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at Aure.Infrastructure.Repositories.UserInviteRepository.GetByTokenAsync(String token) in c:\Users\gabriel\source\repos\GabrielSelim\Aure\src\Aure.Infrastructure\Repositories\UserInviteRepository.cs:line 16
   at Aure.Application.Services.UserService.AcceptInviteAsync(String inviteToken, AcceptInviteRequest request) in c:\Users\gabriel\source\repos\GabrielSelim\Aure\src\Aure.Application\Services\UserService.cs:line 342
   at Aure.API.Controllers.RegistrationController.AceitarConvite(String inviteToken, AcceptInviteRequest request) in c:\Users\gabriel\source\repos\GabrielSelim\Aure\src\Aure.API\Controllers\RegistrationController.cs:line 76
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Serilog.AspNetCore.RequestLoggingMiddleware.Invoke(HttpContext httpContext)
2025-10-20 11:13:31.628 -04:00 [ERR] An unhandled exception has occurred while executing the request.
Microsoft.EntityFrameworkCore.Storage.RetryLimitExceededException: The maximum number of retries (3) was exceeded while executing database operations with 'NpgsqlRetryingExecutionStrategy'. See the inner exception for the most recent failure.
 ---> Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): Nenhuma conexão pôde ser feita porque a máquina de destino as recusou ativamente.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.PoolingDataSource.OpenNewConnector(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.PoolingDataSource.<Get>g__RentAsync|33_0(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at Aure.Infrastructure.Repositories.UserInviteRepository.GetByTokenAsync(String token) in c:\Users\gabriel\source\repos\GabrielSelim\Aure\src\Aure.Infrastructure\Repositories\UserInviteRepository.cs:line 16
   at Aure.Application.Services.UserService.AcceptInviteAsync(String inviteToken, AcceptInviteRequest request) in c:\Users\gabriel\source\repos\GabrielSelim\Aure\src\Aure.Application\Services\UserService.cs:line 342
   at Aure.API.Controllers.RegistrationController.AceitarConvite(String inviteToken, AcceptInviteRequest request) in c:\Users\gabriel\source\repos\GabrielSelim\Aure\src\Aure.API\Controllers\RegistrationController.cs:line 76
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Serilog.AspNetCore.RequestLoggingMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-10-20 11:13:31.690 -04:00 [INF] Request finished HTTP/1.1 POST http://localhost:5203/api/Registration/aceitar-convite/1 - 500 null text/plain; charset=utf-8 23899.7489ms
2025-10-20 11:16:07.061 -04:00 [INF] Application is shutting down...
2025-10-20 12:05:32.106 -04:00 [INF] Starting Aure API application
2025-10-20 12:05:32.200 -04:00 [INF] User profile is available. Using 'C:\Users\gabriel\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-10-20 12:05:32.462 -04:00 [INF] Now listening on: http://localhost:5203
2025-10-20 12:05:32.467 -04:00 [INF] Application started. Press Ctrl+C to shut down.
2025-10-20 12:05:32.469 -04:00 [INF] Hosting environment: Development
2025-10-20 12:05:32.470 -04:00 [INF] Content root path: c:\Users\gabriel\source\repos\GabrielSelim\Aure\src\Aure.API
2025-10-20 12:05:34.451 -04:00 [INF] Request starting HTTP/1.1 GET http://localhost:5203/index.html - null null
2025-10-20 12:05:34.569 -04:00 [INF] Request finished HTTP/1.1 GET http://localhost:5203/index.html - 200 null text/html;charset=utf-8 118.7831ms
2025-10-20 12:05:35.456 -04:00 [INF] Request starting HTTP/1.1 GET http://localhost:5203/swagger/v1/swagger.json - null null
2025-10-20 12:05:35.538 -04:00 [INF] Request starting HTTP/1.1 GET http://localhost:5203/favicon-32x32.png - null null
2025-10-20 12:05:35.558 -04:00 [INF] Sending file. Request path: '/favicon-32x32.png'. Physical path: 'N/A'
2025-10-20 12:05:35.561 -04:00 [INF] Request finished HTTP/1.1 GET http://localhost:5203/favicon-32x32.png - 200 628 image/png 23.011ms
2025-10-20 12:05:35.634 -04:00 [INF] Request finished HTTP/1.1 GET http://localhost:5203/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 178.9247ms
2025-10-20 12:08:31.809 -04:00 [INF] Request starting HTTP/1.1 POST http://localhost:5203/api/Registration/admin-empresa - application/json 219
2025-10-20 12:08:31.844 -04:00 [WRN] Failed to determine the https port for redirect.
2025-10-20 12:08:31.852 -04:00 [INF] CORS policy execution successful.
2025-10-20 12:08:31.939 -04:00 [INF] Executing endpoint 'Aure.API.Controllers.RegistrationController.RegistrarAdminEmpresa (Aure.API)'
2025-10-20 12:08:32.012 -04:00 [INF] Route matched with {action = "RegistrarAdminEmpresa", controller = "Registration"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] RegistrarAdminEmpresa(Aure.Application.DTOs.User.RegisterCompanyAdminRequest) on controller Aure.API.Controllers.RegistrationController (Aure.API).
2025-10-20 12:08:33.649 -04:00 [WRN] Entity 'User' has a global query filter defined and is the required end of a relationship with the entity 'AuditLog'. This may lead to unexpected results when the required entity is filtered out. Either configure the navigation as optional, or define matching query filters for both entities in the navigation. See https://go.microsoft.com/fwlink/?linkid=2131316 for more information.
2025-10-20 12:08:33.650 -04:00 [WRN] Entity 'Company' has a global query filter defined and is the required end of a relationship with the entity 'CompanyRelationship'. This may lead to unexpected results when the required entity is filtered out. Either configure the navigation as optional, or define matching query filters for both entities in the navigation. See https://go.microsoft.com/fwlink/?linkid=2131316 for more information.
2025-10-20 12:08:33.652 -04:00 [WRN] Entity 'Contract' has a global query filter defined and is the required end of a relationship with the entity 'Invoice'. This may lead to unexpected results when the required entity is filtered out. Either configure the navigation as optional, or define matching query filters for both entities in the navigation. See https://go.microsoft.com/fwlink/?linkid=2131316 for more information.
2025-10-20 12:08:33.653 -04:00 [WRN] Entity 'Company' has a global query filter defined and is the required end of a relationship with the entity 'KycRecord'. This may lead to unexpected results when the required entity is filtered out. Either configure the navigation as optional, or define matching query filters for both entities in the navigation. See https://go.microsoft.com/fwlink/?linkid=2131316 for more information.
2025-10-20 12:08:33.654 -04:00 [WRN] Entity 'Contract' has a global query filter defined and is the required end of a relationship with the entity 'LedgerEntry'. This may lead to unexpected results when the required entity is filtered out. Either configure the navigation as optional, or define matching query filters for both entities in the navigation. See https://go.microsoft.com/fwlink/?linkid=2131316 for more information.
2025-10-20 12:08:33.655 -04:00 [WRN] Entity 'User' has a global query filter defined and is the required end of a relationship with the entity 'Session'. This may lead to unexpected results when the required entity is filtered out. Either configure the navigation as optional, or define matching query filters for both entities in the navigation. See https://go.microsoft.com/fwlink/?linkid=2131316 for more information.
2025-10-20 12:08:33.656 -04:00 [WRN] Entity 'Payment' has a global query filter defined and is the required end of a relationship with the entity 'SplitExecution'. This may lead to unexpected results when the required entity is filtered out. Either configure the navigation as optional, or define matching query filters for both entities in the navigation. See https://go.microsoft.com/fwlink/?linkid=2131316 for more information.
2025-10-20 12:08:33.657 -04:00 [WRN] Entity 'Contract' has a global query filter defined and is the required end of a relationship with the entity 'SplitRule'. This may lead to unexpected results when the required entity is filtered out. Either configure the navigation as optional, or define matching query filters for both entities in the navigation. See https://go.microsoft.com/fwlink/?linkid=2131316 for more information.
2025-10-20 12:08:33.659 -04:00 [WRN] Entity 'Contract' has a global query filter defined and is the required end of a relationship with the entity 'TokenizedAsset'. This may lead to unexpected results when the required entity is filtered out. Either configure the navigation as optional, or define matching query filters for both entities in the navigation. See https://go.microsoft.com/fwlink/?linkid=2131316 for more information.
2025-10-20 12:08:38.373 -04:00 [ERR] An error occurred using the connection to database 'aure_db' on server 'tcp://localhost:5432'.
2025-10-20 12:08:38.415 -04:00 [INF] A transient exception occurred during execution. The operation will be retried after 0ms.
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): Nenhuma conexão pôde ser feita porque a máquina de destino as recusou ativamente.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.PoolingDataSource.OpenNewConnector(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.PoolingDataSource.<Get>g__RentAsync|33_0(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): Nenhuma conexão pôde ser feita porque a máquina de destino as recusou ativamente.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.PoolingDataSource.OpenNewConnector(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.PoolingDataSource.<Get>g__RentAsync|33_0(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
2025-10-20 12:08:42.512 -04:00 [ERR] An error occurred using the connection to database 'aure_db' on server 'tcp://localhost:5432'.
2025-10-20 12:08:42.521 -04:00 [INF] A transient exception occurred during execution. The operation will be retried after 1046ms.
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): Nenhuma conexão pôde ser feita porque a máquina de destino as recusou ativamente.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.PoolingDataSource.OpenNewConnector(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.PoolingDataSource.<Get>g__RentAsync|33_0(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): Nenhuma conexão pôde ser feita porque a máquina de destino as recusou ativamente.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.PoolingDataSource.OpenNewConnector(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.PoolingDataSource.<Get>g__RentAsync|33_0(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
2025-10-20 12:08:47.673 -04:00 [ERR] An error occurred using the connection to database 'aure_db' on server 'tcp://localhost:5432'.
2025-10-20 12:08:47.680 -04:00 [INF] A transient exception occurred during execution. The operation will be retried after 3263ms.
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): Nenhuma conexão pôde ser feita porque a máquina de destino as recusou ativamente.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.PoolingDataSource.OpenNewConnector(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.PoolingDataSource.<Get>g__RentAsync|33_0(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): Nenhuma conexão pôde ser feita porque a máquina de destino as recusou ativamente.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.PoolingDataSource.OpenNewConnector(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.PoolingDataSource.<Get>g__RentAsync|33_0(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
2025-10-20 12:08:55.060 -04:00 [ERR] An error occurred using the connection to database 'aure_db' on server 'tcp://localhost:5432'.
2025-10-20 12:08:55.070 -04:00 [ERR] An exception occurred while iterating over the results of a query for context type 'Aure.Infrastructure.Data.AureDbContext'.
Microsoft.EntityFrameworkCore.Storage.RetryLimitExceededException: The maximum number of retries (3) was exceeded while executing database operations with 'NpgsqlRetryingExecutionStrategy'. See the inner exception for the most recent failure.
 ---> Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): Nenhuma conexão pôde ser feita porque a máquina de destino as recusou ativamente.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.PoolingDataSource.OpenNewConnector(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.PoolingDataSource.<Get>g__RentAsync|33_0(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
Microsoft.EntityFrameworkCore.Storage.RetryLimitExceededException: The maximum number of retries (3) was exceeded while executing database operations with 'NpgsqlRetryingExecutionStrategy'. See the inner exception for the most recent failure.
 ---> Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): Nenhuma conexão pôde ser feita porque a máquina de destino as recusou ativamente.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.PoolingDataSource.OpenNewConnector(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.PoolingDataSource.<Get>g__RentAsync|33_0(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
2025-10-20 12:08:55.085 -04:00 [INF] Executed action Aure.API.Controllers.RegistrationController.RegistrarAdminEmpresa (Aure.API) in 23067.7237ms
2025-10-20 12:08:55.086 -04:00 [INF] Executed endpoint 'Aure.API.Controllers.RegistrationController.RegistrarAdminEmpresa (Aure.API)'
2025-10-20 12:08:55.088 -04:00 [ERR] HTTP POST /api/Registration/admin-empresa responded 500 in 23254.2171 ms
Microsoft.EntityFrameworkCore.Storage.RetryLimitExceededException: The maximum number of retries (3) was exceeded while executing database operations with 'NpgsqlRetryingExecutionStrategy'. See the inner exception for the most recent failure.
 ---> Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): Nenhuma conexão pôde ser feita porque a máquina de destino as recusou ativamente.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.PoolingDataSource.OpenNewConnector(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.PoolingDataSource.<Get>g__RentAsync|33_0(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at Aure.Infrastructure.Repositories.UserRepository.EmailExistsAsync(String email) in c:\Users\gabriel\source\repos\GabrielSelim\Aure\src\Aure.Infrastructure\Repositories\UserRepository.cs:line 29
   at Aure.Application.Services.UserService.RegisterCompanyAdminAsync(RegisterCompanyAdminRequest request) in c:\Users\gabriel\source\repos\GabrielSelim\Aure\src\Aure.Application\Services\UserService.cs:line 191
   at Aure.API.Controllers.RegistrationController.RegistrarAdminEmpresa(RegisterCompanyAdminRequest request) in c:\Users\gabriel\source\repos\GabrielSelim\Aure\src\Aure.API\Controllers\RegistrationController.cs:line 34
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Serilog.AspNetCore.RequestLoggingMiddleware.Invoke(HttpContext httpContext)
2025-10-20 12:08:55.179 -04:00 [ERR] An unhandled exception has occurred while executing the request.
Microsoft.EntityFrameworkCore.Storage.RetryLimitExceededException: The maximum number of retries (3) was exceeded while executing database operations with 'NpgsqlRetryingExecutionStrategy'. See the inner exception for the most recent failure.
 ---> Npgsql.NpgsqlException (0x80004005): Failed to connect to 127.0.0.1:5432
 ---> System.Net.Sockets.SocketException (10061): Nenhuma conexão pôde ser feita porque a máquina de destino as recusou ativamente.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at Npgsql.TaskTimeoutAndCancellation.ExecuteAsync(Func`2 getTaskFunc, NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.RawOpen(SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|213_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken, Boolean isFirstAttempt)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.PoolingDataSource.OpenNewConnector(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.PoolingDataSource.<Get>g__RentAsync|33_0(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.<>c__DisplayClass30_0`2.<<ExecuteAsync>b__0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteImplementationAsync[TState,TResult](Func`4 operation, Func`4 verifySucceeded, TState state, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.ExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at Aure.Infrastructure.Repositories.UserRepository.EmailExistsAsync(String email) in c:\Users\gabriel\source\repos\GabrielSelim\Aure\src\Aure.Infrastructure\Repositories\UserRepository.cs:line 29
   at Aure.Application.Services.UserService.RegisterCompanyAdminAsync(RegisterCompanyAdminRequest request) in c:\Users\gabriel\source\repos\GabrielSelim\Aure\src\Aure.Application\Services\UserService.cs:line 191
   at Aure.API.Controllers.RegistrationController.RegistrarAdminEmpresa(RegisterCompanyAdminRequest request) in c:\Users\gabriel\source\repos\GabrielSelim\Aure\src\Aure.API\Controllers\RegistrationController.cs:line 34
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Serilog.AspNetCore.RequestLoggingMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-10-20 12:08:55.220 -04:00 [INF] Request finished HTTP/1.1 POST http://localhost:5203/api/Registration/admin-empresa - 500 null text/plain; charset=utf-8 23412.9628ms
2025-10-20 12:09:43.453 -04:00 [INF] Application is shutting down...
2025-10-20 12:11:42.965 -04:00 [WRN] Entity 'User' has a global query filter defined and is the required end of a relationship with the entity 'AuditLog'. This may lead to unexpected results when the required entity is filtered out. Either configure the navigation as optional, or define matching query filters for both entities in the navigation. See https://go.microsoft.com/fwlink/?linkid=2131316 for more information.
2025-10-20 12:11:43.023 -04:00 [WRN] Entity 'Company' has a global query filter defined and is the required end of a relationship with the entity 'CompanyRelationship'. This may lead to unexpected results when the required entity is filtered out. Either configure the navigation as optional, or define matching query filters for both entities in the navigation. See https://go.microsoft.com/fwlink/?linkid=2131316 for more information.
2025-10-20 12:11:43.027 -04:00 [WRN] Entity 'Contract' has a global query filter defined and is the required end of a relationship with the entity 'Invoice'. This may lead to unexpected results when the required entity is filtered out. Either configure the navigation as optional, or define matching query filters for both entities in the navigation. See https://go.microsoft.com/fwlink/?linkid=2131316 for more information.
2025-10-20 12:11:43.030 -04:00 [WRN] Entity 'Company' has a global query filter defined and is the required end of a relationship with the entity 'KycRecord'. This may lead to unexpected results when the required entity is filtered out. Either configure the navigation as optional, or define matching query filters for both entities in the navigation. See https://go.microsoft.com/fwlink/?linkid=2131316 for more information.
2025-10-20 12:11:43.032 -04:00 [WRN] Entity 'Contract' has a global query filter defined and is the required end of a relationship with the entity 'LedgerEntry'. This may lead to unexpected results when the required entity is filtered out. Either configure the navigation as optional, or define matching query filters for both entities in the navigation. See https://go.microsoft.com/fwlink/?linkid=2131316 for more information.
2025-10-20 12:11:43.035 -04:00 [WRN] Entity 'User' has a global query filter defined and is the required end of a relationship with the entity 'Session'. This may lead to unexpected results when the required entity is filtered out. Either configure the navigation as optional, or define matching query filters for both entities in the navigation. See https://go.microsoft.com/fwlink/?linkid=2131316 for more information.
2025-10-20 12:11:43.040 -04:00 [WRN] Entity 'Payment' has a global query filter defined and is the required end of a relationship with the entity 'SplitExecution'. This may lead to unexpected results when the required entity is filtered out. Either configure the navigation as optional, or define matching query filters for both entities in the navigation. See https://go.microsoft.com/fwlink/?linkid=2131316 for more information.
2025-10-20 12:11:43.044 -04:00 [WRN] Entity 'Contract' has a global query filter defined and is the required end of a relationship with the entity 'SplitRule'. This may lead to unexpected results when the required entity is filtered out. Either configure the navigation as optional, or define matching query filters for both entities in the navigation. See https://go.microsoft.com/fwlink/?linkid=2131316 for more information.
2025-10-20 12:11:43.048 -04:00 [WRN] Entity 'Contract' has a global query filter defined and is the required end of a relationship with the entity 'TokenizedAsset'. This may lead to unexpected results when the required entity is filtered out. Either configure the navigation as optional, or define matching query filters for both entities in the navigation. See https://go.microsoft.com/fwlink/?linkid=2131316 for more information.
2025-10-20 12:11:43.722 -04:00 [INF] Executed DbCommand (41ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-10-20 12:11:43.752 -04:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-10-20 12:11:43.841 -04:00 [INF] Executed DbCommand (13ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "__EFMigrationsHistory" (
    "MigrationId" character varying(150) NOT NULL,
    "ProductVersion" character varying(32) NOT NULL,
    CONSTRAINT "PK___EFMigrationsHistory" PRIMARY KEY ("MigrationId")
);
2025-10-20 12:11:43.864 -04:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2025-10-20 12:11:43.873 -04:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-10-20 12:11:43.888 -04:00 [INF] Applying migration '20251012164321_InitialCreate'.
2025-10-20 12:11:43.969 -04:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";
2025-10-20 12:11:43.994 -04:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE companies (
    id uuid NOT NULL DEFAULT (uuid_generate_v4()),
    name character varying(200) NOT NULL,
    cnpj character varying(18) NOT NULL,
    type integer NOT NULL,
    kyc_status integer NOT NULL,
    created_at timestamp with time zone NOT NULL DEFAULT (CURRENT_TIMESTAMP),
    updated_at timestamp with time zone NOT NULL DEFAULT (CURRENT_TIMESTAMP),
    is_deleted boolean NOT NULL,
    CONSTRAINT "PK_companies" PRIMARY KEY (id)
);
2025-10-20 12:11:44.007 -04:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE users (
    id uuid NOT NULL DEFAULT (uuid_generate_v4()),
    name character varying(100) NOT NULL,
    email character varying(255) NOT NULL,
    password_hash character varying(255) NOT NULL,
    role integer NOT NULL,
    created_at timestamp with time zone NOT NULL DEFAULT (CURRENT_TIMESTAMP),
    updated_at timestamp with time zone NOT NULL DEFAULT (CURRENT_TIMESTAMP),
    is_deleted boolean NOT NULL,
    CONSTRAINT "PK_users" PRIMARY KEY (id)
);
2025-10-20 12:11:44.021 -04:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE contracts (
    id uuid NOT NULL DEFAULT (uuid_generate_v4()),
    client_id uuid NOT NULL,
    provider_id uuid NOT NULL,
    title character varying(255) NOT NULL,
    value_total numeric(18,2) NOT NULL,
    ipfs_cid character varying(100),
    sha256_hash character varying(255) NOT NULL,
    status integer NOT NULL,
    created_at timestamp with time zone NOT NULL DEFAULT (CURRENT_TIMESTAMP),
    updated_at timestamp with time zone NOT NULL DEFAULT (CURRENT_TIMESTAMP),
    is_deleted boolean NOT NULL,
    CONSTRAINT "PK_contracts" PRIMARY KEY (id),
    CONSTRAINT "FK_contracts_companies_client_id" FOREIGN KEY (client_id) REFERENCES companies (id) ON DELETE RESTRICT,
    CONSTRAINT "FK_contracts_companies_provider_id" FOREIGN KEY (provider_id) REFERENCES companies (id) ON DELETE RESTRICT
);
2025-10-20 12:11:44.033 -04:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE kycrecords (
    id uuid NOT NULL,
    company_id uuid NOT NULL,
    document_type integer NOT NULL,
    document_hash text NOT NULL,
    verified_at timestamp with time zone,
    status integer NOT NULL,
    provider_ref text,
    created_at timestamp with time zone NOT NULL,
    updated_at timestamp with time zone NOT NULL,
    is_deleted boolean NOT NULL,
    CONSTRAINT "PK_kycrecords" PRIMARY KEY (id),
    CONSTRAINT "FK_kycrecords_companies_company_id" FOREIGN KEY (company_id) REFERENCES companies (id) ON DELETE CASCADE
);
2025-10-20 12:11:44.048 -04:00 [INF] Executed DbCommand (11ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE auditlogs (
    id uuid NOT NULL,
    entity_name text NOT NULL,
    entity_id uuid NOT NULL,
    action integer NOT NULL,
    performed_by uuid NOT NULL,
    ip_address text NOT NULL,
    timestamp timestamp with time zone NOT NULL,
    hash_chain text NOT NULL,
    created_at timestamp with time zone NOT NULL,
    updated_at timestamp with time zone NOT NULL,
    is_deleted boolean NOT NULL,
    CONSTRAINT "PK_auditlogs" PRIMARY KEY (id),
    CONSTRAINT "FK_auditlogs_users_performed_by" FOREIGN KEY (performed_by) REFERENCES users (id) ON DELETE RESTRICT
);
2025-10-20 12:11:44.064 -04:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE sessions (
    id uuid NOT NULL,
    user_id uuid NOT NULL,
    jwt_hash text NOT NULL,
    expires_at timestamp with time zone NOT NULL,
    created_at timestamp with time zone NOT NULL,
    updated_at timestamp with time zone NOT NULL,
    is_deleted boolean NOT NULL,
    CONSTRAINT "PK_sessions" PRIMARY KEY (id),
    CONSTRAINT "FK_sessions_users_user_id" FOREIGN KEY (user_id) REFERENCES users (id) ON DELETE CASCADE
);
2025-10-20 12:11:44.078 -04:00 [INF] Executed DbCommand (9ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE payments (
    id uuid NOT NULL DEFAULT (uuid_generate_v4()),
    contract_id uuid NOT NULL,
    amount numeric(18,2) NOT NULL,
    method integer NOT NULL,
    status integer NOT NULL,
    payment_date timestamp with time zone,
    company_id uuid,
    created_at timestamp with time zone NOT NULL DEFAULT (CURRENT_TIMESTAMP),
    updated_at timestamp with time zone NOT NULL DEFAULT (CURRENT_TIMESTAMP),
    is_deleted boolean NOT NULL,
    CONSTRAINT "PK_payments" PRIMARY KEY (id),
    CONSTRAINT "FK_payments_companies_company_id" FOREIGN KEY (company_id) REFERENCES companies (id),
    CONSTRAINT "FK_payments_contracts_contract_id" FOREIGN KEY (contract_id) REFERENCES contracts (id) ON DELETE RESTRICT
);
2025-10-20 12:11:44.091 -04:00 [INF] Executed DbCommand (9ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE signatures (
    id uuid NOT NULL DEFAULT (uuid_generate_v4()),
    contract_id uuid NOT NULL,
    user_id uuid NOT NULL,
    signed_at timestamp with time zone NOT NULL DEFAULT (CURRENT_TIMESTAMP),
    signature_hash character varying(255) NOT NULL,
    method integer NOT NULL,
    created_at timestamp with time zone NOT NULL DEFAULT (CURRENT_TIMESTAMP),
    updated_at timestamp with time zone NOT NULL DEFAULT (CURRENT_TIMESTAMP),
    is_deleted boolean NOT NULL,
    CONSTRAINT "PK_signatures" PRIMARY KEY (id),
    CONSTRAINT "FK_signatures_contracts_contract_id" FOREIGN KEY (contract_id) REFERENCES contracts (id) ON DELETE RESTRICT,
    CONSTRAINT "FK_signatures_users_user_id" FOREIGN KEY (user_id) REFERENCES users (id) ON DELETE RESTRICT
);
2025-10-20 12:11:44.111 -04:00 [INF] Executed DbCommand (13ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE splitrules (
    id uuid NOT NULL,
    contract_id uuid NOT NULL,
    beneficiary_ref text NOT NULL,
    percentage numeric NOT NULL,
    fixed_fee numeric,
    priority integer NOT NULL,
    created_at timestamp with time zone NOT NULL,
    updated_at timestamp with time zone NOT NULL,
    is_deleted boolean NOT NULL,
    CONSTRAINT "PK_splitrules" PRIMARY KEY (id),
    CONSTRAINT "FK_splitrules_contracts_contract_id" FOREIGN KEY (contract_id) REFERENCES contracts (id) ON DELETE CASCADE
);
2025-10-20 12:11:44.140 -04:00 [INF] Executed DbCommand (14ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE tokenizedassets (
    id uuid NOT NULL,
    contract_id uuid NOT NULL,
    token_address text NOT NULL,
    chain_id integer NOT NULL,
    tx_hash text NOT NULL,
    created_at timestamp with time zone NOT NULL,
    updated_at timestamp with time zone NOT NULL,
    is_deleted boolean NOT NULL,
    CONSTRAINT "PK_tokenizedassets" PRIMARY KEY (id),
    CONSTRAINT "FK_tokenizedassets_contracts_contract_id" FOREIGN KEY (contract_id) REFERENCES contracts (id) ON DELETE CASCADE
);
2025-10-20 12:11:44.159 -04:00 [INF] Executed DbCommand (15ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE invoices (
    id uuid NOT NULL,
    contract_id uuid NOT NULL,
    payment_id uuid,
    invoice_number text NOT NULL,
    series text NOT NULL,
    access_key text NOT NULL,
    issue_date timestamp with time zone NOT NULL,
    due_date timestamp with time zone,
    total_amount numeric NOT NULL,
    tax_amount numeric NOT NULL,
    status integer NOT NULL,
    xml_content text NOT NULL,
    pdf_url text,
    cancellation_reason text,
    sefaz_protocol text,
    created_at timestamp with time zone NOT NULL,
    updated_at timestamp with time zone NOT NULL,
    is_deleted boolean NOT NULL,
    CONSTRAINT "PK_invoices" PRIMARY KEY (id),
    CONSTRAINT "FK_invoices_contracts_contract_id" FOREIGN KEY (contract_id) REFERENCES contracts (id) ON DELETE CASCADE,
    CONSTRAINT "FK_invoices_payments_payment_id" FOREIGN KEY (payment_id) REFERENCES payments (id)
);
2025-10-20 12:11:44.178 -04:00 [INF] Executed DbCommand (14ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE ledgerentries (
    id uuid NOT NULL,
    payment_id uuid NOT NULL,
    contract_id uuid NOT NULL,
    debit numeric NOT NULL,
    credit numeric NOT NULL,
    currency text NOT NULL,
    timestamp timestamp with time zone NOT NULL,
    note text,
    created_at timestamp with time zone NOT NULL,
    updated_at timestamp with time zone NOT NULL,
    is_deleted boolean NOT NULL,
    CONSTRAINT "PK_ledgerentries" PRIMARY KEY (id),
    CONSTRAINT "FK_ledgerentries_contracts_contract_id" FOREIGN KEY (contract_id) REFERENCES contracts (id) ON DELETE CASCADE,
    CONSTRAINT "FK_ledgerentries_payments_payment_id" FOREIGN KEY (payment_id) REFERENCES payments (id) ON DELETE CASCADE
);
2025-10-20 12:11:44.202 -04:00 [INF] Executed DbCommand (20ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE notifications (
    id uuid NOT NULL,
    contract_id uuid,
    payment_id uuid,
    type integer NOT NULL,
    recipient_email text NOT NULL,
    subject text NOT NULL,
    content text NOT NULL,
    sent_at timestamp with time zone,
    status integer NOT NULL,
    created_at timestamp with time zone NOT NULL,
    updated_at timestamp with time zone NOT NULL,
    is_deleted boolean NOT NULL,
    CONSTRAINT "PK_notifications" PRIMARY KEY (id),
    CONSTRAINT "FK_notifications_contracts_contract_id" FOREIGN KEY (contract_id) REFERENCES contracts (id),
    CONSTRAINT "FK_notifications_payments_payment_id" FOREIGN KEY (payment_id) REFERENCES payments (id)
);
2025-10-20 12:11:44.215 -04:00 [INF] Executed DbCommand (9ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE splitexecutions (
    id uuid NOT NULL,
    payment_id uuid NOT NULL,
    split_id uuid NOT NULL,
    value numeric NOT NULL,
    executed_at timestamp with time zone NOT NULL,
    tx_hash text,
    status integer NOT NULL,
    split_rule_id uuid NOT NULL,
    created_at timestamp with time zone NOT NULL,
    updated_at timestamp with time zone NOT NULL,
    is_deleted boolean NOT NULL,
    CONSTRAINT "PK_splitexecutions" PRIMARY KEY (id),
    CONSTRAINT "FK_splitexecutions_payments_payment_id" FOREIGN KEY (payment_id) REFERENCES payments (id) ON DELETE CASCADE,
    CONSTRAINT "FK_splitexecutions_splitrules_split_rule_id" FOREIGN KEY (split_rule_id) REFERENCES splitrules (id) ON DELETE CASCADE
);
2025-10-20 12:11:44.231 -04:00 [INF] Executed DbCommand (12ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE invoiceitems (
    id uuid NOT NULL,
    invoice_id uuid NOT NULL,
    item_sequence integer NOT NULL,
    description text NOT NULL,
    ncm_code text NOT NULL,
    quantity numeric NOT NULL,
    unit_value numeric NOT NULL,
    total_value numeric NOT NULL,
    tax_classification text NOT NULL,
    created_at timestamp with time zone NOT NULL,
    updated_at timestamp with time zone NOT NULL,
    is_deleted boolean NOT NULL,
    CONSTRAINT "PK_invoiceitems" PRIMARY KEY (id),
    CONSTRAINT "FK_invoiceitems_invoices_invoice_id" FOREIGN KEY (invoice_id) REFERENCES invoices (id) ON DELETE CASCADE
);
2025-10-20 12:11:44.246 -04:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE taxcalculations (
    id uuid NOT NULL,
    invoice_id uuid NOT NULL,
    tax_type integer NOT NULL,
    tax_rate numeric NOT NULL,
    tax_base numeric NOT NULL,
    tax_amount numeric NOT NULL,
    created_at timestamp with time zone NOT NULL,
    updated_at timestamp with time zone NOT NULL,
    is_deleted boolean NOT NULL,
    CONSTRAINT "PK_taxcalculations" PRIMARY KEY (id),
    CONSTRAINT "FK_taxcalculations_invoices_invoice_id" FOREIGN KEY (invoice_id) REFERENCES invoices (id) ON DELETE CASCADE
);
2025-10-20 12:11:44.257 -04:00 [INF] Executed DbCommand (7ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_auditlogs_performed_by" ON auditlogs (performed_by);
2025-10-20 12:11:44.265 -04:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE UNIQUE INDEX idx_companies_cnpj ON companies (cnpj);
2025-10-20 12:11:44.273 -04:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX idx_companies_created_at ON companies (created_at);
2025-10-20 12:11:44.281 -04:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX idx_companies_kyc_status ON companies (kyc_status);
2025-10-20 12:11:44.290 -04:00 [INF] Executed DbCommand (7ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX idx_companies_type ON companies (type);
2025-10-20 12:11:44.299 -04:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX idx_contracts_client_id ON contracts (client_id);
2025-10-20 12:11:44.310 -04:00 [INF] Executed DbCommand (7ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX idx_contracts_created_at ON contracts (created_at);
2025-10-20 12:11:44.316 -04:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX idx_contracts_provider_id ON contracts (provider_id);
2025-10-20 12:11:44.324 -04:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE UNIQUE INDEX idx_contracts_sha256_hash ON contracts (sha256_hash);
2025-10-20 12:11:44.334 -04:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX idx_contracts_status ON contracts (status);
2025-10-20 12:11:44.343 -04:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_invoiceitems_invoice_id" ON invoiceitems (invoice_id);
2025-10-20 12:11:44.353 -04:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_invoices_contract_id" ON invoices (contract_id);
2025-10-20 12:11:44.363 -04:00 [INF] Executed DbCommand (7ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_invoices_payment_id" ON invoices (payment_id);
2025-10-20 12:11:44.374 -04:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_kycrecords_company_id" ON kycrecords (company_id);
2025-10-20 12:11:44.384 -04:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_ledgerentries_contract_id" ON ledgerentries (contract_id);
2025-10-20 12:11:44.397 -04:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_ledgerentries_payment_id" ON ledgerentries (payment_id);
2025-10-20 12:11:44.411 -04:00 [INF] Executed DbCommand (12ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_notifications_contract_id" ON notifications (contract_id);
2025-10-20 12:11:44.429 -04:00 [INF] Executed DbCommand (14ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_notifications_payment_id" ON notifications (payment_id);
2025-10-20 12:11:44.439 -04:00 [INF] Executed DbCommand (7ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX idx_payments_contract_id ON payments (contract_id);
2025-10-20 12:11:44.450 -04:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX idx_payments_created_at ON payments (created_at);
2025-10-20 12:11:44.461 -04:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX idx_payments_method ON payments (method);
2025-10-20 12:11:44.471 -04:00 [INF] Executed DbCommand (7ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX idx_payments_payment_date ON payments (payment_date);
2025-10-20 12:11:44.481 -04:00 [INF] Executed DbCommand (7ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX idx_payments_status ON payments (status);
2025-10-20 12:11:44.491 -04:00 [INF] Executed DbCommand (7ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_payments_company_id" ON payments (company_id);
2025-10-20 12:11:44.504 -04:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_sessions_user_id" ON sessions (user_id);
2025-10-20 12:11:44.521 -04:00 [INF] Executed DbCommand (13ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX idx_signatures_contract_id ON signatures (contract_id);
2025-10-20 12:11:44.536 -04:00 [INF] Executed DbCommand (11ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE UNIQUE INDEX idx_signatures_contract_user_unique ON signatures (contract_id, user_id);
2025-10-20 12:11:44.549 -04:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX idx_signatures_signed_at ON signatures (signed_at);
2025-10-20 12:11:44.564 -04:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX idx_signatures_user_id ON signatures (user_id);
2025-10-20 12:11:44.583 -04:00 [INF] Executed DbCommand (15ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_splitexecutions_payment_id" ON splitexecutions (payment_id);
2025-10-20 12:11:44.598 -04:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_splitexecutions_split_rule_id" ON splitexecutions (split_rule_id);
2025-10-20 12:11:44.616 -04:00 [INF] Executed DbCommand (13ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_splitrules_contract_id" ON splitrules (contract_id);
2025-10-20 12:11:44.627 -04:00 [INF] Executed DbCommand (7ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_taxcalculations_invoice_id" ON taxcalculations (invoice_id);
2025-10-20 12:11:44.637 -04:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE UNIQUE INDEX "IX_tokenizedassets_contract_id" ON tokenizedassets (contract_id);
2025-10-20 12:11:44.649 -04:00 [INF] Executed DbCommand (9ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX idx_users_created_at ON users (created_at);
2025-10-20 12:11:44.659 -04:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE UNIQUE INDEX idx_users_email ON users (email);
2025-10-20 12:11:44.671 -04:00 [INF] Executed DbCommand (7ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX idx_users_role ON users (role);
2025-10-20 12:11:44.678 -04:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20251012164321_InitialCreate', '8.0.11');
2025-10-20 12:11:44.693 -04:00 [INF] Applying migration '20251012171837_AddCompanyIdToUser'.
2025-10-20 12:11:44.744 -04:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE users ADD company_id uuid;
2025-10-20 12:11:44.753 -04:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_users_company_id" ON users (company_id);
2025-10-20 12:11:44.761 -04:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE users ADD CONSTRAINT "FK_users_companies_company_id" FOREIGN KEY (company_id) REFERENCES companies (id) ON DELETE RESTRICT;
2025-10-20 12:11:44.766 -04:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20251012171837_AddCompanyIdToUser', '8.0.11');
2025-10-20 12:11:44.773 -04:00 [INF] Applying migration '20251012191149_AddBusinessModelToCompany'.
2025-10-20 12:11:44.812 -04:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE companies ADD business_model integer NOT NULL DEFAULT 0;
2025-10-20 12:11:44.817 -04:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20251012191149_AddBusinessModelToCompany', '8.0.11');
2025-10-20 12:11:44.824 -04:00 [INF] Applying migration '20251012193722_AddUserInvitesTable'.
2025-10-20 12:11:44.879 -04:00 [INF] Executed DbCommand (9ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE userinvites (
    id uuid NOT NULL,
    inviter_name character varying(200) NOT NULL,
    invitee_email character varying(255) NOT NULL,
    invitee_name character varying(200) NOT NULL,
    role integer NOT NULL,
    business_model integer,
    company_name character varying(300),
    cnpj character varying(18),
    company_type integer,
    company_id uuid NOT NULL,
    invited_by_user_id uuid NOT NULL,
    token character varying(50) NOT NULL,
    expires_at timestamp with time zone NOT NULL,
    is_accepted boolean NOT NULL DEFAULT FALSE,
    invite_type integer NOT NULL,
    created_at timestamp with time zone NOT NULL,
    updated_at timestamp with time zone NOT NULL,
    is_deleted boolean NOT NULL,
    CONSTRAINT "PK_userinvites" PRIMARY KEY (id),
    CONSTRAINT "FK_userinvites_companies_company_id" FOREIGN KEY (company_id) REFERENCES companies (id) ON DELETE RESTRICT,
    CONSTRAINT "FK_userinvites_users_invited_by_user_id" FOREIGN KEY (invited_by_user_id) REFERENCES users (id) ON DELETE RESTRICT
);
2025-10-20 12:11:44.887 -04:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_userinvites_company_id_is_accepted_is_deleted" ON userinvites (company_id, is_accepted, is_deleted);
2025-10-20 12:11:44.895 -04:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_userinvites_invited_by_user_id" ON userinvites (invited_by_user_id);
2025-10-20 12:11:44.903 -04:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_userinvites_invitee_email" ON userinvites (invitee_email);
2025-10-20 12:11:44.913 -04:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE UNIQUE INDEX "IX_userinvites_token" ON userinvites (token);
2025-10-20 12:11:44.916 -04:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20251012193722_AddUserInvitesTable', '8.0.11');
2025-10-20 12:11:44.925 -04:00 [INF] Applying migration '20251012201236_AddCompanyRelationships'.
2025-10-20 12:11:44.978 -04:00 [INF] Executed DbCommand (11ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE companyrelationships (
    id uuid NOT NULL,
    client_company_id uuid NOT NULL,
    provider_company_id uuid NOT NULL,
    type integer NOT NULL,
    status integer NOT NULL,
    start_date timestamp with time zone NOT NULL,
    end_date timestamp with time zone,
    notes text,
    created_at timestamp with time zone NOT NULL,
    updated_at timestamp with time zone NOT NULL,
    is_deleted boolean NOT NULL,
    CONSTRAINT "PK_companyrelationships" PRIMARY KEY (id),
    CONSTRAINT "FK_companyrelationships_companies_client_company_id" FOREIGN KEY (client_company_id) REFERENCES companies (id) ON DELETE RESTRICT,
    CONSTRAINT "FK_companyrelationships_companies_provider_company_id" FOREIGN KEY (provider_company_id) REFERENCES companies (id) ON DELETE RESTRICT
);
2025-10-20 12:11:44.987 -04:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE UNIQUE INDEX "IX_companyrelationships_client_company_id_provider_company_id_~" ON companyrelationships (client_company_id, provider_company_id, type) WHERE is_deleted = false;
2025-10-20 12:11:44.994 -04:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_companyrelationships_provider_company_id" ON companyrelationships (provider_company_id);
2025-10-20 12:11:44.999 -04:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20251012201236_AddCompanyRelationships', '8.0.11');
2025-10-20 12:11:59.667 -04:00 [INF] Starting Aure API application
2025-10-20 12:11:59.738 -04:00 [INF] User profile is available. Using 'C:\Users\gabriel\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-10-20 12:11:59.823 -04:00 [INF] Now listening on: http://localhost:5203
2025-10-20 12:11:59.827 -04:00 [INF] Application started. Press Ctrl+C to shut down.
2025-10-20 12:11:59.828 -04:00 [INF] Hosting environment: Development
2025-10-20 12:11:59.828 -04:00 [INF] Content root path: c:\Users\gabriel\source\repos\GabrielSelim\Aure\src\Aure.API
2025-10-20 12:18:07.419 -04:00 [INF] Request starting HTTP/1.1 GET http://localhost:5203/index.html - null null
2025-10-20 12:18:07.641 -04:00 [INF] Request finished HTTP/1.1 GET http://localhost:5203/index.html - 200 null text/html;charset=utf-8 229.7222ms
2025-10-20 12:18:07.746 -04:00 [INF] Request starting HTTP/1.1 GET http://localhost:5203/swagger-ui.css - null null
2025-10-20 12:18:07.760 -04:00 [INF] Request starting HTTP/1.1 GET http://localhost:5203/swagger-ui-bundle.js - null null
2025-10-20 12:18:07.762 -04:00 [INF] Request starting HTTP/1.1 GET http://localhost:5203/swagger-ui-standalone-preset.js - null null
2025-10-20 12:18:07.845 -04:00 [INF] Sending file. Request path: '/swagger-ui-standalone-preset.js'. Physical path: 'N/A'
2025-10-20 12:18:07.845 -04:00 [INF] Sending file. Request path: '/swagger-ui.css'. Physical path: 'N/A'
2025-10-20 12:18:07.853 -04:00 [INF] Request finished HTTP/1.1 GET http://localhost:5203/swagger-ui-standalone-preset.js - 200 230280 text/javascript 91.4136ms
2025-10-20 12:18:07.855 -04:00 [INF] Request finished HTTP/1.1 GET http://localhost:5203/swagger-ui.css - 200 152034 text/css 108.3682ms
2025-10-20 12:18:07.877 -04:00 [INF] Sending file. Request path: '/swagger-ui-bundle.js'. Physical path: 'N/A'
2025-10-20 12:18:07.881 -04:00 [INF] Request finished HTTP/1.1 GET http://localhost:5203/swagger-ui-bundle.js - 200 1456926 text/javascript 120.5341ms
2025-10-20 12:18:08.066 -04:00 [INF] Request starting HTTP/1.1 GET http://localhost:5203/swagger/v1/swagger.json - null null
2025-10-20 12:18:08.091 -04:00 [INF] Request starting HTTP/1.1 GET http://localhost:5203/favicon-32x32.png - null null
2025-10-20 12:18:08.102 -04:00 [INF] Sending file. Request path: '/favicon-32x32.png'. Physical path: 'N/A'
2025-10-20 12:18:08.106 -04:00 [INF] Request finished HTTP/1.1 GET http://localhost:5203/favicon-32x32.png - 200 628 image/png 15.0224ms
2025-10-20 12:18:08.321 -04:00 [INF] Request finished HTTP/1.1 GET http://localhost:5203/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 254.3075ms
2025-10-20 12:18:20.675 -04:00 [INF] Request starting HTTP/1.1 POST http://localhost:5203/api/Registration/admin-empresa - application/json 219
2025-10-20 12:18:20.690 -04:00 [WRN] Failed to determine the https port for redirect.
2025-10-20 12:18:20.695 -04:00 [INF] CORS policy execution successful.
2025-10-20 12:18:20.773 -04:00 [INF] Executing endpoint 'Aure.API.Controllers.RegistrationController.RegistrarAdminEmpresa (Aure.API)'
2025-10-20 12:18:20.857 -04:00 [INF] Route matched with {action = "RegistrarAdminEmpresa", controller = "Registration"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] RegistrarAdminEmpresa(Aure.Application.DTOs.User.RegisterCompanyAdminRequest) on controller Aure.API.Controllers.RegistrationController (Aure.API).
2025-10-20 12:18:21.752 -04:00 [WRN] Entity 'User' has a global query filter defined and is the required end of a relationship with the entity 'AuditLog'. This may lead to unexpected results when the required entity is filtered out. Either configure the navigation as optional, or define matching query filters for both entities in the navigation. See https://go.microsoft.com/fwlink/?linkid=2131316 for more information.
2025-10-20 12:18:21.755 -04:00 [WRN] Entity 'Company' has a global query filter defined and is the required end of a relationship with the entity 'CompanyRelationship'. This may lead to unexpected results when the required entity is filtered out. Either configure the navigation as optional, or define matching query filters for both entities in the navigation. See https://go.microsoft.com/fwlink/?linkid=2131316 for more information.
2025-10-20 12:18:21.756 -04:00 [WRN] Entity 'Contract' has a global query filter defined and is the required end of a relationship with the entity 'Invoice'. This may lead to unexpected results when the required entity is filtered out. Either configure the navigation as optional, or define matching query filters for both entities in the navigation. See https://go.microsoft.com/fwlink/?linkid=2131316 for more information.
2025-10-20 12:18:21.757 -04:00 [WRN] Entity 'Company' has a global query filter defined and is the required end of a relationship with the entity 'KycRecord'. This may lead to unexpected results when the required entity is filtered out. Either configure the navigation as optional, or define matching query filters for both entities in the navigation. See https://go.microsoft.com/fwlink/?linkid=2131316 for more information.
2025-10-20 12:18:21.761 -04:00 [WRN] Entity 'Contract' has a global query filter defined and is the required end of a relationship with the entity 'LedgerEntry'. This may lead to unexpected results when the required entity is filtered out. Either configure the navigation as optional, or define matching query filters for both entities in the navigation. See https://go.microsoft.com/fwlink/?linkid=2131316 for more information.
2025-10-20 12:18:21.762 -04:00 [WRN] Entity 'User' has a global query filter defined and is the required end of a relationship with the entity 'Session'. This may lead to unexpected results when the required entity is filtered out. Either configure the navigation as optional, or define matching query filters for both entities in the navigation. See https://go.microsoft.com/fwlink/?linkid=2131316 for more information.
2025-10-20 12:18:21.764 -04:00 [WRN] Entity 'Payment' has a global query filter defined and is the required end of a relationship with the entity 'SplitExecution'. This may lead to unexpected results when the required entity is filtered out. Either configure the navigation as optional, or define matching query filters for both entities in the navigation. See https://go.microsoft.com/fwlink/?linkid=2131316 for more information.
2025-10-20 12:18:21.765 -04:00 [WRN] Entity 'Contract' has a global query filter defined and is the required end of a relationship with the entity 'SplitRule'. This may lead to unexpected results when the required entity is filtered out. Either configure the navigation as optional, or define matching query filters for both entities in the navigation. See https://go.microsoft.com/fwlink/?linkid=2131316 for more information.
2025-10-20 12:18:21.767 -04:00 [WRN] Entity 'Contract' has a global query filter defined and is the required end of a relationship with the entity 'TokenizedAsset'. This may lead to unexpected results when the required entity is filtered out. Either configure the navigation as optional, or define matching query filters for both entities in the navigation. See https://go.microsoft.com/fwlink/?linkid=2131316 for more information.
2025-10-20 12:18:22.859 -04:00 [INF] Executed DbCommand (73ms) [Parameters=[@__ToLower_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM users AS u
    WHERE NOT (u.is_deleted) AND lower(u.email) = @__ToLower_0)
2025-10-20 12:18:22.918 -04:00 [INF] Executed DbCommand (10ms) [Parameters=[@__cleanCnpj_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM companies AS c
    WHERE NOT (c.is_deleted) AND c.cnpj = @__cleanCnpj_0)
2025-10-20 12:18:22.929 -04:00 [INF] CNPJ validation requested for 24345700000186
2025-10-20 12:18:22.933 -04:00 [INF] Calling BrasilAPI for CNPJ 24345700000186 at URL: https://brasilapi.com.br/api/cnpj/v1/24345700000186
2025-10-20 12:18:22.947 -04:00 [INF] Start processing HTTP request GET https://brasilapi.com.br/api/cnpj/v1/24345700000186
2025-10-20 12:18:22.956 -04:00 [INF] Sending HTTP request GET https://brasilapi.com.br/api/cnpj/v1/24345700000186
2025-10-20 12:18:24.036 -04:00 [INF] Received HTTP response headers after 1074.2747ms - 200
2025-10-20 12:18:24.038 -04:00 [INF] End processing HTTP request after 1092.0832ms - 200
2025-10-20 12:18:24.044 -04:00 [INF] CNPJ 24345700000186 validated successfully with BrasilAPI. Company: HARALD WEINERT, Status: ATIVA
2025-10-20 12:18:24.403 -04:00 [INF] Executed DbCommand (11ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (DbType = Int32), @p2='?', @p3='?' (DbType = DateTime), @p4='?' (DbType = Boolean), @p5='?' (DbType = Int32), @p6='?', @p7='?' (DbType = Int32), @p8='?' (DbType = DateTime), @p9='?' (DbType = Guid), @p10='?' (DbType = Guid), @p11='?' (DbType = DateTime), @p12='?', @p13='?' (DbType = Boolean), @p14='?', @p15='?', @p16='?' (DbType = Int32), @p17='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO companies (id, business_model, cnpj, created_at, is_deleted, kyc_status, name, type, updated_at)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8);
INSERT INTO users (id, company_id, created_at, email, is_deleted, name, password_hash, role, updated_at)
VALUES (@p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);
2025-10-20 12:18:24.429 -04:00 [INF] Usuário admin da empresa registrado com sucesso com ID "d233baff-52d1-4f33-8d90-b15d35ad25a8"
2025-10-20 12:18:24.436 -04:00 [INF] Executing OkObjectResult, writing value of type 'Aure.Application.DTOs.User.UserResponse'.
2025-10-20 12:18:24.461 -04:00 [INF] Executed action Aure.API.Controllers.RegistrationController.RegistrarAdminEmpresa (Aure.API) in 3597.8404ms
2025-10-20 12:18:24.464 -04:00 [INF] Executed endpoint 'Aure.API.Controllers.RegistrationController.RegistrarAdminEmpresa (Aure.API)'
2025-10-20 12:18:24.468 -04:00 [INF] HTTP POST /api/Registration/admin-empresa responded 200 in 3782.1666 ms
2025-10-20 12:18:24.474 -04:00 [INF] Request finished HTTP/1.1 POST http://localhost:5203/api/Registration/admin-empresa - 200 null application/json; charset=utf-8 3798.8826ms
2025-10-20 12:18:49.549 -04:00 [INF] Request starting HTTP/1.1 POST http://localhost:5203/api/Auth/entrar - application/json 68
2025-10-20 12:18:49.555 -04:00 [INF] CORS policy execution successful.
2025-10-20 12:18:49.558 -04:00 [INF] Executing endpoint 'Aure.API.Controllers.AuthController.Login (Aure.API)'
2025-10-20 12:18:49.564 -04:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(Aure.Application.DTOs.User.LoginRequest) on controller Aure.API.Controllers.AuthController (Aure.API).
2025-10-20 12:18:49.652 -04:00 [INF] Executed DbCommand (6ms) [Parameters=[@__ToLower_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT u.id, u.company_id, u.created_at, u.email, u.is_deleted, u.name, u.password_hash, u.role, u.updated_at
FROM users AS u
WHERE NOT (u.is_deleted) AND lower(u.email) = @__ToLower_0
LIMIT 1
2025-10-20 12:18:49.830 -04:00 [INF] Usuário logado com sucesso com ID "d233baff-52d1-4f33-8d90-b15d35ad25a8"
2025-10-20 12:18:49.854 -04:00 [INF] Successful login for user "d233baff-52d1-4f33-8d90-b15d35ad25a8"
2025-10-20 12:18:49.855 -04:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType13`4[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[Aure.Application.DTOs.User.UserResponse, Aure.Application, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-10-20 12:18:49.863 -04:00 [INF] Executed action Aure.API.Controllers.AuthController.Login (Aure.API) in 296.259ms
2025-10-20 12:18:49.864 -04:00 [INF] Executed endpoint 'Aure.API.Controllers.AuthController.Login (Aure.API)'
2025-10-20 12:18:49.866 -04:00 [INF] HTTP POST /api/Auth/entrar responded 200 in 311.2125 ms
2025-10-20 12:18:49.868 -04:00 [INF] Request finished HTTP/1.1 POST http://localhost:5203/api/Auth/entrar - 200 null application/json; charset=utf-8 319.6292ms
2025-10-20 12:19:49.481 -04:00 [INF] Request starting HTTP/1.1 POST http://localhost:5203/api/Registration/convidar-usuario - application/json 249
2025-10-20 12:19:49.488 -04:00 [INF] CORS policy execution successful.
2025-10-20 12:19:49.565 -04:00 [INF] Executing endpoint 'Aure.API.Controllers.RegistrationController.ConvidarUsuario (Aure.API)'
2025-10-20 12:19:49.573 -04:00 [INF] Route matched with {action = "ConvidarUsuario", controller = "Registration"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ConvidarUsuario(Aure.Application.DTOs.User.InviteUserRequest) on controller Aure.API.Controllers.RegistrationController (Aure.API).
2025-10-20 12:19:49.637 -04:00 [INF] Executed DbCommand (3ms) [Parameters=[@__ToLower_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM users AS u
    WHERE NOT (u.is_deleted) AND lower(u.email) = @__ToLower_0)
2025-10-20 12:19:49.654 -04:00 [INF] Executed DbCommand (7ms) [Parameters=[@__ToLower_0='?', @__now_1='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM userinvites AS u
    WHERE NOT (u.is_deleted) AND lower(u.invitee_email) = @__ToLower_0 AND NOT (u.is_accepted) AND u.expires_at > @__now_1 AND NOT (u.is_deleted))
2025-10-20 12:19:49.676 -04:00 [INF] Executed DbCommand (2ms) [Parameters=[@__get_Item_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT u.id, u.company_id, u.created_at, u.email, u.is_deleted, u.name, u.password_hash, u.role, u.updated_at
FROM users AS u
WHERE NOT (u.is_deleted) AND u.id = @__get_Item_0
LIMIT 1
2025-10-20 12:19:49.694 -04:00 [INF] Executed DbCommand (3ms) [Parameters=[@__get_Item_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT c.id, c.business_model, c.cnpj, c.created_at, c.is_deleted, c.kyc_status, c.name, c.type, c.updated_at
FROM companies AS c
WHERE NOT (c.is_deleted) AND c.id = @__get_Item_0
LIMIT 1
2025-10-20 12:19:49.703 -04:00 [INF] CNPJ validation requested for 49644431000180
2025-10-20 12:19:49.705 -04:00 [INF] Calling BrasilAPI for CNPJ 49644431000180 at URL: https://brasilapi.com.br/api/cnpj/v1/49644431000180
2025-10-20 12:19:49.706 -04:00 [INF] Start processing HTTP request GET https://brasilapi.com.br/api/cnpj/v1/49644431000180
2025-10-20 12:19:49.709 -04:00 [INF] Sending HTTP request GET https://brasilapi.com.br/api/cnpj/v1/49644431000180
2025-10-20 12:19:50.448 -04:00 [INF] Received HTTP response headers after 736.4703ms - 200
2025-10-20 12:19:50.451 -04:00 [INF] End processing HTTP request after 744.1334ms - 200
2025-10-20 12:19:50.456 -04:00 [INF] CNPJ 49644431000180 validated successfully with BrasilAPI. Company: MTX LABS SUPLEMENTOS LTDA, Status: ATIVA
2025-10-20 12:19:50.466 -04:00 [INF] Executed DbCommand (2ms) [Parameters=[@__cleanCnpj_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM companies AS c
    WHERE NOT (c.is_deleted) AND c.cnpj = @__cleanCnpj_0)
2025-10-20 12:19:50.561 -04:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (DbType = Int32), @p2='?', @p3='?' (DbType = Guid), @p4='?', @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = DateTime), @p8='?' (DbType = Int32), @p9='?' (DbType = Guid), @p10='?', @p11='?', @p12='?', @p13='?' (DbType = Boolean), @p14='?' (DbType = Int32), @p15='?', @p16='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO userinvites (id, business_model, cnpj, company_id, company_name, company_type, created_at, expires_at, invite_type, invited_by_user_id, invitee_email, invitee_name, inviter_name, is_deleted, role, token, updated_at)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16)
RETURNING is_accepted;
2025-10-20 12:19:53.031 -04:00 [ERR] Erro ao enviar email de convite para eng.gabrielsanz@hotmail.com
MailKit.Security.SslHandshakeException: An error occurred while attempting to establish an SSL or TLS connection.

When connecting to an SMTP service, port 587 is typically reserved for plain-text connections. If
you intended to connect to SMTP on the SSL port, try connecting to port 465 instead. Otherwise,
if you intended to use STARTTLS, make sure to use the following code:

client.Connect ("smtp.gmail.com", 587, SecureSocketOptions.StartTls);

 ---> System.Security.Authentication.AuthenticationException: Cannot determine the frame size or a corrupted frame was received.
   at System.Net.Security.SslStream.GetFrameSize(ReadOnlySpan`1 buffer)
   at System.Net.Security.SslStream.EnsureFullTlsFrameAsync[TIOAdapter](CancellationToken cancellationToken, Int32 estimatedSize)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.Security.SslStream.ReceiveHandshakeFrameAsync[TIOAdapter](CancellationToken cancellationToken)
   at System.Net.Security.SslStream.ForceAuthenticationAsync[TIOAdapter](Boolean receiveFirst, Byte[] reAuthenticationData, CancellationToken cancellationToken)
   at MailKit.Net.Smtp.SmtpClient.SslHandshakeAsync(SslStream ssl, String host, CancellationToken cancellationToken)
   at MailKit.Net.Smtp.SmtpClient.ConnectAsync(String host, Int32 port, SecureSocketOptions options, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at MailKit.Net.Smtp.SmtpClient.ConnectAsync(String host, Int32 port, SecureSocketOptions options, CancellationToken cancellationToken)
   at Aure.Infrastructure.Services.EmailService.SendInviteEmailAsync(String recipientEmail, String recipientName, String inviteToken, String inviterName, String companyName) in c:\Users\gabriel\source\repos\GabrielSelim\Aure\src\Aure.Infrastructure\Services\EmailService.cs:line 45
2025-10-20 12:19:53.077 -04:00 [WRN] Falha ao enviar email de convite para eng.gabrielsanz@hotmail.com, mas convite foi salvo com ID "fbd6f981-afe5-4948-acb8-fdae076c8c1c"
2025-10-20 12:19:53.079 -04:00 [INF] Convite criado com sucesso com ID "fbd6f981-afe5-4948-acb8-fdae076c8c1c" para o email eng.gabrielsanz@hotmail.com
2025-10-20 12:19:53.081 -04:00 [INF] Executing OkObjectResult, writing value of type 'Aure.Application.DTOs.User.InviteResponse'.
2025-10-20 12:19:53.088 -04:00 [INF] Executed action Aure.API.Controllers.RegistrationController.ConvidarUsuario (Aure.API) in 3512.1619ms
2025-10-20 12:19:53.090 -04:00 [INF] Executed endpoint 'Aure.API.Controllers.RegistrationController.ConvidarUsuario (Aure.API)'
2025-10-20 12:19:53.091 -04:00 [INF] HTTP POST /api/Registration/convidar-usuario responded 200 in 3603.7170 ms
2025-10-20 12:19:53.093 -04:00 [INF] Request finished HTTP/1.1 POST http://localhost:5203/api/Registration/convidar-usuario - 200 null application/json; charset=utf-8 3611.9113ms
2025-10-20 12:21:26.841 -04:00 [INF] Application is shutting down...
2025-10-20 12:22:27.762 -04:00 [INF] Starting Aure API application
2025-10-20 12:22:27.843 -04:00 [INF] User profile is available. Using 'C:\Users\gabriel\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-10-20 12:22:27.916 -04:00 [INF] Now listening on: http://localhost:5203
2025-10-20 12:22:27.921 -04:00 [INF] Application started. Press Ctrl+C to shut down.
2025-10-20 12:22:27.922 -04:00 [INF] Hosting environment: Development
2025-10-20 12:22:27.923 -04:00 [INF] Content root path: c:\Users\gabriel\source\repos\GabrielSelim\Aure\src\Aure.API
2025-10-20 12:30:54.741 -04:00 [INF] Application is shutting down...
2025-10-20 12:31:02.900 -04:00 [INF] Starting Aure API application
2025-10-20 12:31:02.976 -04:00 [INF] User profile is available. Using 'C:\Users\gabriel\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-10-20 12:31:03.063 -04:00 [INF] Now listening on: http://localhost:5203
2025-10-20 12:31:03.070 -04:00 [INF] Application started. Press Ctrl+C to shut down.
2025-10-20 12:31:03.072 -04:00 [INF] Hosting environment: Development
2025-10-20 12:31:03.074 -04:00 [INF] Content root path: c:\Users\gabriel\source\repos\GabrielSelim\Aure\src\Aure.API
2025-10-20 12:32:24.237 -04:00 [INF] Request starting HTTP/1.1 POST http://localhost:5203/api/Auth/entrar - application/json 68
2025-10-20 12:32:24.321 -04:00 [WRN] Failed to determine the https port for redirect.
2025-10-20 12:32:24.327 -04:00 [INF] CORS policy execution successful.
2025-10-20 12:32:24.482 -04:00 [INF] Executing endpoint 'Aure.API.Controllers.AuthController.Login (Aure.API)'
2025-10-20 12:32:24.538 -04:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(Aure.Application.DTOs.User.LoginRequest) on controller Aure.API.Controllers.AuthController (Aure.API).
2025-10-20 12:32:25.604 -04:00 [WRN] Entity 'User' has a global query filter defined and is the required end of a relationship with the entity 'AuditLog'. This may lead to unexpected results when the required entity is filtered out. Either configure the navigation as optional, or define matching query filters for both entities in the navigation. See https://go.microsoft.com/fwlink/?linkid=2131316 for more information.
2025-10-20 12:32:25.607 -04:00 [WRN] Entity 'Company' has a global query filter defined and is the required end of a relationship with the entity 'CompanyRelationship'. This may lead to unexpected results when the required entity is filtered out. Either configure the navigation as optional, or define matching query filters for both entities in the navigation. See https://go.microsoft.com/fwlink/?linkid=2131316 for more information.
2025-10-20 12:32:25.609 -04:00 [WRN] Entity 'Contract' has a global query filter defined and is the required end of a relationship with the entity 'Invoice'. This may lead to unexpected results when the required entity is filtered out. Either configure the navigation as optional, or define matching query filters for both entities in the navigation. See https://go.microsoft.com/fwlink/?linkid=2131316 for more information.
2025-10-20 12:32:25.612 -04:00 [WRN] Entity 'Company' has a global query filter defined and is the required end of a relationship with the entity 'KycRecord'. This may lead to unexpected results when the required entity is filtered out. Either configure the navigation as optional, or define matching query filters for both entities in the navigation. See https://go.microsoft.com/fwlink/?linkid=2131316 for more information.
2025-10-20 12:32:25.614 -04:00 [WRN] Entity 'Contract' has a global query filter defined and is the required end of a relationship with the entity 'LedgerEntry'. This may lead to unexpected results when the required entity is filtered out. Either configure the navigation as optional, or define matching query filters for both entities in the navigation. See https://go.microsoft.com/fwlink/?linkid=2131316 for more information.
2025-10-20 12:32:25.615 -04:00 [WRN] Entity 'User' has a global query filter defined and is the required end of a relationship with the entity 'Session'. This may lead to unexpected results when the required entity is filtered out. Either configure the navigation as optional, or define matching query filters for both entities in the navigation. See https://go.microsoft.com/fwlink/?linkid=2131316 for more information.
2025-10-20 12:32:25.617 -04:00 [WRN] Entity 'Payment' has a global query filter defined and is the required end of a relationship with the entity 'SplitExecution'. This may lead to unexpected results when the required entity is filtered out. Either configure the navigation as optional, or define matching query filters for both entities in the navigation. See https://go.microsoft.com/fwlink/?linkid=2131316 for more information.
2025-10-20 12:32:25.619 -04:00 [WRN] Entity 'Contract' has a global query filter defined and is the required end of a relationship with the entity 'SplitRule'. This may lead to unexpected results when the required entity is filtered out. Either configure the navigation as optional, or define matching query filters for both entities in the navigation. See https://go.microsoft.com/fwlink/?linkid=2131316 for more information.
2025-10-20 12:32:25.621 -04:00 [WRN] Entity 'Contract' has a global query filter defined and is the required end of a relationship with the entity 'TokenizedAsset'. This may lead to unexpected results when the required entity is filtered out. Either configure the navigation as optional, or define matching query filters for both entities in the navigation. See https://go.microsoft.com/fwlink/?linkid=2131316 for more information.
2025-10-20 12:32:26.735 -04:00 [INF] Executed DbCommand (54ms) [Parameters=[@__ToLower_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT u.id, u.company_id, u.created_at, u.email, u.is_deleted, u.name, u.password_hash, u.role, u.updated_at
FROM users AS u
WHERE NOT (u.is_deleted) AND lower(u.email) = @__ToLower_0
LIMIT 1
2025-10-20 12:32:27.094 -04:00 [INF] Usuário logado com sucesso com ID "d233baff-52d1-4f33-8d90-b15d35ad25a8"
2025-10-20 12:32:27.114 -04:00 [INF] Successful login for user "d233baff-52d1-4f33-8d90-b15d35ad25a8"
2025-10-20 12:32:27.121 -04:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType13`4[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[Aure.Application.DTOs.User.UserResponse, Aure.Application, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-10-20 12:32:27.172 -04:00 [INF] Executed action Aure.API.Controllers.AuthController.Login (Aure.API) in 2625.2607ms
2025-10-20 12:32:27.179 -04:00 [INF] Executed endpoint 'Aure.API.Controllers.AuthController.Login (Aure.API)'
2025-10-20 12:32:27.186 -04:00 [INF] HTTP POST /api/Auth/entrar responded 200 in 2865.8522 ms
2025-10-20 12:32:27.198 -04:00 [INF] Request finished HTTP/1.1 POST http://localhost:5203/api/Auth/entrar - 200 null application/json; charset=utf-8 2964.6921ms
2025-10-20 12:32:42.882 -04:00 [INF] Request starting HTTP/1.1 POST http://localhost:5203/api/Registration/convidar-usuario - application/json 249
2025-10-20 12:32:42.889 -04:00 [INF] CORS policy execution successful.
2025-10-20 12:32:42.902 -04:00 [INF] Executing endpoint 'Aure.API.Controllers.RegistrationController.ConvidarUsuario (Aure.API)'
2025-10-20 12:32:42.912 -04:00 [INF] Route matched with {action = "ConvidarUsuario", controller = "Registration"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ConvidarUsuario(Aure.Application.DTOs.User.InviteUserRequest) on controller Aure.API.Controllers.RegistrationController (Aure.API).
2025-10-20 12:32:43.040 -04:00 [INF] Executed DbCommand (4ms) [Parameters=[@__ToLower_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM users AS u
    WHERE NOT (u.is_deleted) AND lower(u.email) = @__ToLower_0)
2025-10-20 12:32:43.056 -04:00 [INF] Executed DbCommand (8ms) [Parameters=[@__ToLower_0='?', @__now_1='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM userinvites AS u
    WHERE NOT (u.is_deleted) AND lower(u.invitee_email) = @__ToLower_0 AND NOT (u.is_accepted) AND u.expires_at > @__now_1 AND NOT (u.is_deleted))
2025-10-20 12:32:43.061 -04:00 [WRN] Email eng.gabrielsanz@hotmail.com já tem um convite pendente
2025-10-20 12:32:43.063 -04:00 [ERR] Falha ao convidar usuário: Email já tem um convite pendente
2025-10-20 12:32:43.067 -04:00 [INF] Executing BadRequestObjectResult, writing value of type '<>f__AnonymousType88`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-10-20 12:32:43.070 -04:00 [INF] Executed action Aure.API.Controllers.RegistrationController.ConvidarUsuario (Aure.API) in 154.8532ms
2025-10-20 12:32:43.073 -04:00 [INF] Executed endpoint 'Aure.API.Controllers.RegistrationController.ConvidarUsuario (Aure.API)'
2025-10-20 12:32:43.075 -04:00 [INF] HTTP POST /api/Registration/convidar-usuario responded 400 in 186.5569 ms
2025-10-20 12:32:43.078 -04:00 [INF] Request finished HTTP/1.1 POST http://localhost:5203/api/Registration/convidar-usuario - 400 null application/json; charset=utf-8 196.4489ms
2025-10-20 12:32:56.597 -04:00 [INF] Request starting HTTP/1.1 POST http://localhost:5203/api/Registration/convidar-usuario - application/json 241
2025-10-20 12:32:56.602 -04:00 [INF] CORS policy execution successful.
2025-10-20 12:32:56.608 -04:00 [INF] Executing endpoint 'Aure.API.Controllers.RegistrationController.ConvidarUsuario (Aure.API)'
2025-10-20 12:32:56.610 -04:00 [INF] Route matched with {action = "ConvidarUsuario", controller = "Registration"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ConvidarUsuario(Aure.Application.DTOs.User.InviteUserRequest) on controller Aure.API.Controllers.RegistrationController (Aure.API).
2025-10-20 12:32:56.649 -04:00 [INF] Executed DbCommand (4ms) [Parameters=[@__ToLower_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM users AS u
    WHERE NOT (u.is_deleted) AND lower(u.email) = @__ToLower_0)
2025-10-20 12:32:56.657 -04:00 [INF] Executed DbCommand (3ms) [Parameters=[@__ToLower_0='?', @__now_1='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM userinvites AS u
    WHERE NOT (u.is_deleted) AND lower(u.invitee_email) = @__ToLower_0 AND NOT (u.is_accepted) AND u.expires_at > @__now_1 AND NOT (u.is_deleted))
2025-10-20 12:32:56.685 -04:00 [INF] Executed DbCommand (3ms) [Parameters=[@__get_Item_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT u.id, u.company_id, u.created_at, u.email, u.is_deleted, u.name, u.password_hash, u.role, u.updated_at
FROM users AS u
WHERE NOT (u.is_deleted) AND u.id = @__get_Item_0
LIMIT 1
2025-10-20 12:32:56.702 -04:00 [INF] Executed DbCommand (3ms) [Parameters=[@__get_Item_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT c.id, c.business_model, c.cnpj, c.created_at, c.is_deleted, c.kyc_status, c.name, c.type, c.updated_at
FROM companies AS c
WHERE NOT (c.is_deleted) AND c.id = @__get_Item_0
LIMIT 1
2025-10-20 12:32:56.764 -04:00 [INF] CNPJ validation requested for 49644431000180
2025-10-20 12:32:56.767 -04:00 [INF] Calling BrasilAPI for CNPJ 49644431000180 at URL: https://brasilapi.com.br/api/cnpj/v1/49644431000180
2025-10-20 12:32:56.776 -04:00 [INF] Start processing HTTP request GET https://brasilapi.com.br/api/cnpj/v1/49644431000180
2025-10-20 12:32:56.783 -04:00 [INF] Sending HTTP request GET https://brasilapi.com.br/api/cnpj/v1/49644431000180
2025-10-20 12:32:57.201 -04:00 [INF] Received HTTP response headers after 414.1648ms - 200
2025-10-20 12:32:57.205 -04:00 [INF] End processing HTTP request after 430.7884ms - 200
2025-10-20 12:32:57.213 -04:00 [INF] CNPJ 49644431000180 validated successfully with BrasilAPI. Company: MTX LABS SUPLEMENTOS LTDA, Status: ATIVA
2025-10-20 12:32:57.222 -04:00 [INF] Executed DbCommand (2ms) [Parameters=[@__cleanCnpj_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM companies AS c
    WHERE NOT (c.is_deleted) AND c.cnpj = @__cleanCnpj_0)
2025-10-20 12:32:57.430 -04:00 [INF] Executed DbCommand (7ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (DbType = Int32), @p2='?', @p3='?' (DbType = Guid), @p4='?', @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = DateTime), @p8='?' (DbType = Int32), @p9='?' (DbType = Guid), @p10='?', @p11='?', @p12='?', @p13='?' (DbType = Boolean), @p14='?' (DbType = Int32), @p15='?', @p16='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO userinvites (id, business_model, cnpj, company_id, company_name, company_type, created_at, expires_at, invite_type, invited_by_user_id, invitee_email, invitee_name, inviter_name, is_deleted, role, token, updated_at)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16)
RETURNING is_accepted;
2025-10-20 12:33:02.802 -04:00 [INF] Email de convite enviado com sucesso para iamcull@hotmail.com
2025-10-20 12:33:02.805 -04:00 [INF] Convite criado com sucesso com ID "5571070d-fa6c-4553-9226-fa51b9df7d7e" para o email iamcull@hotmail.com
2025-10-20 12:33:02.808 -04:00 [INF] Executing OkObjectResult, writing value of type 'Aure.Application.DTOs.User.InviteResponse'.
2025-10-20 12:33:02.813 -04:00 [INF] Executed action Aure.API.Controllers.RegistrationController.ConvidarUsuario (Aure.API) in 6199.7888ms
2025-10-20 12:33:02.815 -04:00 [INF] Executed endpoint 'Aure.API.Controllers.RegistrationController.ConvidarUsuario (Aure.API)'
2025-10-20 12:33:02.816 -04:00 [INF] HTTP POST /api/Registration/convidar-usuario responded 200 in 6214.1949 ms
2025-10-20 12:33:02.821 -04:00 [INF] Request finished HTTP/1.1 POST http://localhost:5203/api/Registration/convidar-usuario - 200 null application/json; charset=utf-8 6224.031ms
